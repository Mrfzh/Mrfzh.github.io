<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="google-site-verification" content="X7_M3eeaLhvcnX4TXnFCfa8gF_OXS5CEpA0zKHEBuLY">















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/F-32x21.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/F-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.0',
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="前言 本文所有代码基于 JDK 1.8  主要分析最基本的构造方法及增删改查操作，最后在此基础上分析一些其他的方法。">
<meta name="keywords" content="源码">
<meta property="og:type" content="article">
<meta property="og:title" content="TreeMap 源码分析">
<meta property="og:url" content="https://mrfzh.github.io/2019/08/20/TreeMap-源码分析/index.html">
<meta property="og:site_name" content="FengZH的博客">
<meta property="og:description" content="前言 本文所有代码基于 JDK 1.8  主要分析最基本的构造方法及增删改查操作，最后在此基础上分析一些其他的方法。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.ibb.co/MPHkJNM/rotate-left.png">
<meta property="og:image" content="https://i.ibb.co/0q7zt04/rotate-right.png">
<meta property="og:image" content="https://i.ibb.co/87P9Hkp/create-br-tree.png">
<meta property="og:image" content="https://i.ibb.co/nzHvFgY/insert-15.png">
<meta property="og:image" content="https://i.ibb.co/Fmyjjpz/delete-node-1.png">
<meta property="og:image" content="https://i.ibb.co/D4SVgwY/delete-node-2.png">
<meta property="og:image" content="https://i.ibb.co/jk7Yh4b/delete-node-3.png">
<meta property="og:image" content="https://i.ibb.co/PmkpXqs/delete-node-4.png">
<meta property="og:updated_time" content="2019-08-20T07:37:57.734Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TreeMap 源码分析">
<meta name="twitter:description" content="前言 本文所有代码基于 JDK 1.8  主要分析最基本的构造方法及增删改查操作，最后在此基础上分析一些其他的方法。">
<meta name="twitter:image" content="https://i.ibb.co/MPHkJNM/rotate-left.png">





  
  
  <link rel="canonical" href="https://mrfzh.github.io/2019/08/20/TreeMap-源码分析/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>TreeMap 源码分析 | FengZH的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">FengZH的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mrfzh.github.io/2019/08/20/TreeMap-源码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FengZH">
      <meta itemprop="description" content="阳光总在风雨后！坚持就是胜利！">
      <meta itemprop="image" content="https://i.ibb.co/ZNQVBbd/head-Image1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FengZH的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">TreeMap 源码分析

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-20 15:37:12 / 修改时间：15:37:57" itemprop="dateCreated datePublished" datetime="2019-08-20T15:37:12+08:00">2019-08-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>本文所有代码基于 JDK 1.8</p>
</blockquote>
<p>主要分析最基本的构造方法及增删改查操作，最后在此基础上分析一些其他的方法。</p>
<a id="more"></a>
<h1 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为 null 表示自然排序（从小到大）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;? <span class="keyword">super</span> K&gt; comparator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 红黑树（Entry 是红黑树节点）的根节点</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;K,V&gt; root;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元素个数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构性修改次数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>其中，Comparator 是一个接口，可用于自定义排序方式，接口中有一个 compare 方法，该方法返回一个 int 值，返回值为正数，零，负数各代表大于，等于，小于。</p>
<p>Entry 用于存储元素，下面看下它的实现：</p>
<h2 id="Entry"><a href="#Entry" class="headerlink" title="Entry"></a>Entry</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">      K key;</span><br><span class="line">      V value;</span><br><span class="line">      Entry&lt;K,V&gt; left;</span><br><span class="line">      Entry&lt;K,V&gt; right;</span><br><span class="line">      Entry&lt;K,V&gt; parent;</span><br><span class="line">      <span class="keyword">boolean</span> color = BLACK;</span><br><span class="line"></span><br><span class="line">      Entry(K key, V value, Entry&lt;K,V&gt; parent) &#123;</span><br><span class="line">          <span class="keyword">this</span>.key = key;</span><br><span class="line">          <span class="keyword">this</span>.value = value;</span><br><span class="line">          <span class="keyword">this</span>.parent = parent;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> key;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V value)</span> </span>&#123;</span><br><span class="line">          V oldValue = <span class="keyword">this</span>.value;</span><br><span class="line">          <span class="keyword">this</span>.value = value;</span><br><span class="line">          <span class="keyword">return</span> oldValue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Map.Entry))</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">          Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> valEquals(key,e.getKey()) &amp;&amp; valEquals(value,e.getValue());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">int</span> keyHash = (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode());</span><br><span class="line">          <span class="keyword">int</span> valueHash = (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">          <span class="keyword">return</span> keyHash ^ valueHash;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> key + <span class="string">"="</span> + value;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>代码还是很好懂的，显然，Entry 是一个红黑树节点，持有左右孩子及父节点的引用。</p>
<p>了解了基本的成员变量，接下来看它的几个构造方法：</p>
<h1 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h1><ol>
<li>TreeMap()<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    comparator = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>默认构造方法，将 comparator 设置为 null，元素的排序方式为自然排序。</p>
<ol start="2">
<li>TreeMap(Comparator&lt;? super K&gt; comparator)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> K&gt; comparator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.comparator = comparator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>带 Comparator 参数，可自定义排序。</p>
<ol start="3">
<li>TreeMap(Map&lt;? extends K, ? extends V&gt; m) <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">    comparator = <span class="keyword">null</span>;</span><br><span class="line">    putAll(m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>该方法将另一个 Map 的所有元素添加到当前 TreeMap</p>
<ol start="4">
<li>TreeMap(SortedMap&lt;K, ? extends V&gt; m)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">(SortedMap&lt;K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">    comparator = m.comparator();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        buildFromSorted(m.size(), m.entrySet().iterator(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>和上一个构造方法类似，该方法传入一个 SortedMap（TreeMap 就是其中一个 SortedMap），要求该 SortedMap 的 key 类型要和自己的 key 类型一致。</p>
<p>简单看过各个构造方法，接下来就分析一些基本的增删改查操作，先看 put 方法：</p>
<h1 id="put"><a href="#put" class="headerlink" title="put"></a>put</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">      Entry&lt;K,V&gt; t = root;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建根节点</span></span><br><span class="line">      <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">	<span class="comment">// 如果不指定 Comparator，或指定的 Comparator 没有处理空指针异常</span></span><br><span class="line">	<span class="comment">// 则 key 不能为 null，否则在比较元素时会引发空指针异常</span></span><br><span class="line">          compare(key, key);</span><br><span class="line">	</span><br><span class="line">          root = <span class="keyword">new</span> Entry&lt;&gt;(key, value, <span class="keyword">null</span>);</span><br><span class="line">          size = <span class="number">1</span>;</span><br><span class="line">          modCount++;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> cmp;</span><br><span class="line">      Entry&lt;K,V&gt; parent;</span><br><span class="line">      Comparator&lt;? <span class="keyword">super</span> K&gt; cpr = comparator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到插入节点的父节点，以及其插入位置（父节点的左边还是右边）</span></span><br><span class="line"><span class="comment">// 如果发现比较结果相等的节点，更新该节点的值并返回旧的元素</span></span><br><span class="line">      <span class="keyword">if</span> (cpr != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">do</span> &#123;</span><br><span class="line">              parent = t;</span><br><span class="line">              cmp = cpr.compare(key, t.key);</span><br><span class="line">              <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                  t = t.left;</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                  t = t.right;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">          &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">      &#125;	</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line">	Comparable&lt;? <span class="keyword">super</span> K&gt; k = (Comparable&lt;? <span class="keyword">super</span> K&gt;) key;</span><br><span class="line">          <span class="keyword">do</span> &#123;</span><br><span class="line">              parent = t;</span><br><span class="line">              cmp = k.compareTo(t.key);</span><br><span class="line">              <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                  t = t.left;</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                  t = t.right;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">          &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造节点并插入到相应位置</span></span><br><span class="line">      Entry&lt;K,V&gt; e = <span class="keyword">new</span> Entry&lt;&gt;(key, value, parent);</span><br><span class="line">      <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">          parent.left = e;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          parent.right = e;</span><br><span class="line"></span><br><span class="line"><span class="comment">// （1）</span></span><br><span class="line"><span class="comment">// 调整成规范的红黑树</span></span><br><span class="line">      fixAfterInsertion(e);</span><br><span class="line"></span><br><span class="line">      size++;</span><br><span class="line">      modCount++;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>要注意，<strong>如果不指定 Comparator，或指定的 Comparator 没有处理空指针异常，则 key 不能为 null，否则在比较元素时会引发空指针异常</strong>。</p>
<p>总结下添加元素的过程：</p>
<ol>
<li>如果还没有节点就创建根节点，并返回 null。</li>
<li>找到插入节点的父节点和插入位置，如果在查找过程出现比较结果相等的节点，更新该节点的值并返回旧的值。</li>
<li>构造节点并插入到相应位置。</li>
<li>调整成规范的红黑树。</li>
</ol>
<p>下面分析下第四步，也就是注释（1）处的 fixAfterInsertion 方法：</p>
<h2 id="fixAfterInsertion"><a href="#fixAfterInsertion" class="headerlink" title="fixAfterInsertion"></a>fixAfterInsertion</h2><p>由于红黑树调整过程涉及到左旋和右旋，它们的实现分别对应 rotateLeft 和 rotateRight 方法，看下 rotateLeft（rotateRight 就不贴了，和 rotateLeft 类似，只是左右反过来而已）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry&lt;K,V&gt; r = p.right;</span><br><span class="line">        p.right = r.left;</span><br><span class="line">        <span class="keyword">if</span> (r.left != <span class="keyword">null</span>)</span><br><span class="line">            r.left.parent = p;</span><br><span class="line">        r.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = r;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">            p.parent.left = r;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p.parent.right = r;</span><br><span class="line">        r.left = p;</span><br><span class="line">        p.parent = r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码我就不用文字说明了，免得把人绕晕，直接上图，这样更加直观：</p>
<p><img src="https://i.ibb.co/MPHkJNM/rotate-left.png" alt="左旋"></p>
<p>右旋原理也一样，如图：</p>
<p><img src="https://i.ibb.co/0q7zt04/rotate-right.png" alt="右旋"></p>
<p>了解了左旋和右旋，接下来看 fixAfterInsertion 的代码实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 将插入节点置为红色节点</span></span><br><span class="line">      x.color = RED;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">	<span class="comment">// 如果 x 的父节点（设为 xp）是其父节点（设为 xpp）的左孩子</span></span><br><span class="line">          <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123;</span><br><span class="line">		<span class="comment">// y 为 xpp 的右孩子，即 xp 的右兄弟</span></span><br><span class="line">              Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x)));</span><br><span class="line">		<span class="comment">// y 为红色节点，就将 xp，y 置为黑色，将 xpp 置为红色，最后 x 置为 xpp</span></span><br><span class="line">              <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                  setColor(parentOf(x), BLACK);</span><br><span class="line">                  setColor(y, BLACK);</span><br><span class="line">                  setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                  x = parentOf(parentOf(x));</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;	<span class="comment">// y 为 黑色节点或 y 为 null</span></span><br><span class="line">			<span class="comment">// 如果 x 是其父节点的右孩子，先将 x 置为 xp，然后对 x 进行左旋操作</span></span><br><span class="line">                  <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                      x = parentOf(x);</span><br><span class="line">                      rotateLeft(x);</span><br><span class="line">                  &#125;</span><br><span class="line">			<span class="comment">// 将 xp 置为黑色，xpp 置为红色，以 xpp 为中心进行右旋操作</span></span><br><span class="line">                  setColor(parentOf(x), BLACK);</span><br><span class="line">                  setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                  rotateRight(parentOf(parentOf(x)));</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; </span><br><span class="line">	<span class="comment">// 如果 x 的父节点（设为 xp）是其父节点（设为 xpp）的右孩子</span></span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// y 为 xpp 的左孩子，即 xp 的左兄弟</span></span><br><span class="line">              Entry&lt;K,V&gt; y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">		<span class="comment">// y 为红色节点，就将 xp，y 置为黑色，将 xpp 置为红色，最后 x 置为 xpp</span></span><br><span class="line">              <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                  setColor(parentOf(x), BLACK);</span><br><span class="line">                  setColor(y, BLACK);</span><br><span class="line">                  setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                  x = parentOf(parentOf(x));</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;    <span class="comment">// y 为 黑色节点或 y 为 null</span></span><br><span class="line">			<span class="comment">// 如果 x 是其父节点的左孩子，先将 x 置为 xp，然后对 x 进行右旋操作</span></span><br><span class="line">                  <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                      x = parentOf(x);</span><br><span class="line">                      rotateRight(x);</span><br><span class="line">                  &#125;</span><br><span class="line">			<span class="comment">// 将 xp 置为黑色，xpp 置为红色，以 xpp 为中心进行左旋操作</span></span><br><span class="line">                  setColor(parentOf(x), BLACK);</span><br><span class="line">                  setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                  rotateLeft(parentOf(parentOf(x)));</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">// 根节点置为黑色节点</span></span><br><span class="line">      root.color = BLACK;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>过程的话注释都有说明，不过这样并不直观，还是用图来说话。</p>
<p>假设依次插入 1, 3, 5, 7, 9, 11, 13, 15。这是一个升序序列，如果不进行调整的话，节点都会堆在右子树，查找效率就变为 O(n) 了。</p>
<p>先看下依次插入 1, 3, 5, 7, 9, 11, 13 后形成的红黑树：</p>
<p><img src="https://i.ibb.co/87P9Hkp/create-br-tree.png" alt></p>
<p>接下来看下插入节点 15 的过程：</p>
<p><img src="https://i.ibb.co/nzHvFgY/insert-15.png" alt></p>
<p>在插入节点 15 的时候，需要在 while 循环中循环两次，也就是有两步，如果不懂得为什么要这样调整。</p>
<p>如果看不懂图示的过程，可以自己跟着代码走一遍。</p>
<p>看完红黑树的调整过程，回到 TreeMap，刚才看完了 put 方法，接下来就看下 remove 方法：</p>
<h1 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line"><span class="comment">// （1）</span></span><br><span class="line"><span class="comment">// 获得删除节点，没有该节点则返回 null</span></span><br><span class="line">      Entry&lt;K,V&gt; p = getEntry(key);</span><br><span class="line">      <span class="keyword">if</span> (p == <span class="keyword">null</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">      V oldValue = p.value;</span><br><span class="line"></span><br><span class="line"><span class="comment">// （2）</span></span><br><span class="line"><span class="comment">// 删除相应节点</span></span><br><span class="line">      deleteEntry(p);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> oldValue;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>删除节点的第一步是获得删除节点，具体看注释（1）处的 getEntry 方法：</p>
<h2 id="getEntry"><a href="#getEntry" class="headerlink" title="getEntry"></a>getEntry</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">getEntry</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 设置了 Comparator 时，获取过程也类似，只不过在比较时利用的是 Comparator </span></span><br><span class="line">      <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">          <span class="keyword">return</span> getEntryUsingComparator(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找时 key 不能为 null</span></span><br><span class="line"><span class="comment">// （其实如果没有设置 Comparator 的话，插入的时候已经不能为 null 了）</span></span><br><span class="line">      <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">      </span><br><span class="line"><span class="comment">// 没有设置 Comparator 时根据自然排序（Comparable）的结果</span></span><br><span class="line"><span class="comment">// 在红黑树中找到相应的节点，若没有找到则返回 null</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">          Comparable&lt;? <span class="keyword">super</span> K&gt; k = (Comparable&lt;? <span class="keyword">super</span> K&gt;) key;</span><br><span class="line">      Entry&lt;K,V&gt; p = root;</span><br><span class="line">      <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">int</span> cmp = k.compareTo(p.key);</span><br><span class="line">          <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">              p = p.left;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">              p = p.right;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>根据 key 来获得节点，利用 Comparator 或 Comparable 比较 key 后，如果返回结果为 0，说明 key 相等，该 key 对应节点即为所找节点。</p>
<p>回到 remove 方法，继续看注释（2）处的 deleteEntry 方法，该方法删除相应节点：</p>
<h2 id="deleteEntry"><a href="#deleteEntry" class="headerlink" title="deleteEntry"></a>deleteEntry</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteEntry</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">      modCount++;</span><br><span class="line">      size--;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果删除节点左右孩子皆不为空，先给它找到一个替代节点 s</span></span><br><span class="line"><span class="comment">// s 为 p 的右子树的深度最大的左孩子（即在平衡二叉树中，删除节点的下一节点）</span></span><br><span class="line"><span class="comment">// 然后将被删除节点的 key 和 value 置为 s 的 key 和 value，并将 p 置为 s</span></span><br><span class="line">      <span class="keyword">if</span> (p.left != <span class="keyword">null</span> &amp;&amp; p.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">          Entry&lt;K,V&gt; s = successor(p);</span><br><span class="line">          p.key = s.key;</span><br><span class="line">          p.value = s.value;</span><br><span class="line">          p = s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 若 p 的左孩子不为空，则 replacement 为 p 的左孩子，否则为 p 的右孩子</span></span><br><span class="line">      <span class="comment">// 注意：执行到这里时，p 最多只能有一个孩子（没有孩子也可能）  </span></span><br><span class="line">      Entry&lt;K,V&gt; replacement = (p.left != <span class="keyword">null</span> ? p.left : p.right);</span><br><span class="line">      </span><br><span class="line"><span class="comment">// 节点 p 有孩子</span></span><br><span class="line">      <span class="keyword">if</span> (replacement != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">// 节点 p 的孩子顶替节点 p 的位置</span></span><br><span class="line">          replacement.parent = p.parent;</span><br><span class="line">          <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">              root = replacement;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (p == p.parent.left)</span><br><span class="line">              p.parent.left  = replacement;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">              p.parent.right = replacement;</span><br><span class="line">	<span class="comment">// 删除节点 p</span></span><br><span class="line">          p.left = p.right = p.parent = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果节点 p 为黑色，需要调整删除了节点 p 后的树</span></span><br><span class="line">          <span class="keyword">if</span> (p.color == BLACK)</span><br><span class="line">              fixAfterDeletion(replacement);</span><br><span class="line">      &#125; </span><br><span class="line"><span class="comment">// 只有一个节点时，将根节点置为空</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>) &#123; </span><br><span class="line">          root = <span class="keyword">null</span>;</span><br><span class="line">      &#125; </span><br><span class="line"><span class="comment">// 节点 p 没有孩子</span></span><br><span class="line"><span class="keyword">else</span> &#123; </span><br><span class="line">          <span class="comment">// 如果节点 p 为黑色，调整红黑树</span></span><br><span class="line">          <span class="keyword">if</span> (p.color == BLACK)</span><br><span class="line">              fixAfterDeletion(p);</span><br><span class="line">	<span class="comment">// 删除节点 p</span></span><br><span class="line">          <span class="keyword">if</span> (p.parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">if</span> (p == p.parent.left)</span><br><span class="line">                  p.parent.left = <span class="keyword">null</span>;</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (p == p.parent.right)</span><br><span class="line">                  p.parent.right = <span class="keyword">null</span>;</span><br><span class="line">              p.parent = <span class="keyword">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这个方法比较长，重点是读懂它的逻辑。总的来说，该方法会根据删除节点所处的位置分了几种情况：</p>
<ol>
<li>删除节点的左右孩子皆不为空</li>
<li>删除节点只有左孩子或只有右孩子</li>
<li>删除节点没有孩子</li>
</ol>
<p>不同情况有不同的操作，但最终都是由两个操作组成：删除对应节点，以及调整红黑树。</p>
<p>下面还是用图来说明，以上面生成的红黑树为例：</p>
<p><img src="https://i.ibb.co/Fmyjjpz/delete-node-1.png" alt></p>
<p>首先分析删除节点的左右孩子皆不为空的情况，这里删除节点 11：</p>
<p><img src="https://i.ibb.co/D4SVgwY/delete-node-2.png" alt></p>
<p>最后还要调整红黑树，调整操作在 fixAfterDeletion 方法中，之后再分析这个方法，这里先看删除部分。</p>
<p>还有另外两种情况，删除节点只有左孩子或只有右孩子，以及删除节点没有孩子，这两种情况的删除比较简单，分别以删除节点 13 和节点 9 为例：</p>
<p><img src="https://i.ibb.co/jk7Yh4b/delete-node-3.png" alt></p>
<p>在删除节点 13 时，最后还要进行调整，这里放在后面分析。在删除节点 9 时，需要在删除操作前先进行调整工作，这里直接给出了调整后的结果。</p>
<p>现在就来看一下删除后红黑树的调整，该操作在 fixAfterDeletion 方法中：</p>
<h2 id="fixAfterDeletion"><a href="#fixAfterDeletion" class="headerlink" title="fixAfterDeletion"></a>fixAfterDeletion</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterDeletion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 如果 x 不是根节点，并且为黑色节点</span></span><br><span class="line">      <span class="keyword">while</span> (x != root &amp;&amp; colorOf(x) == BLACK) &#123;</span><br><span class="line">	<span class="comment">// x 是其父节点的左孩子</span></span><br><span class="line">          <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">              Entry&lt;K,V&gt; sib = rightOf(parentOf(x));</span><br><span class="line">		<span class="comment">// x 的右兄弟为红色节点</span></span><br><span class="line">              <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                  setColor(sib, BLACK);</span><br><span class="line">                  setColor(parentOf(x), RED);</span><br><span class="line">                  rotateLeft(parentOf(x));</span><br><span class="line">                  sib = rightOf(parentOf(x));</span><br><span class="line">              &#125;</span><br><span class="line">		<span class="comment">// x 的右兄弟的左右孩子皆为黑色节点</span></span><br><span class="line">              <span class="keyword">if</span> (colorOf(leftOf(sib))  == BLACK &amp;&amp;</span><br><span class="line">                  colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                  setColor(sib, RED);</span><br><span class="line">                  x = parentOf(x);</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                      setColor(leftOf(sib), BLACK);</span><br><span class="line">                      setColor(sib, RED);</span><br><span class="line">                      rotateRight(sib);</span><br><span class="line">                      sib = rightOf(parentOf(x));</span><br><span class="line">                  &#125;</span><br><span class="line">                  setColor(sib, colorOf(parentOf(x)));</span><br><span class="line">                  setColor(parentOf(x), BLACK);</span><br><span class="line">                  setColor(rightOf(sib), BLACK);</span><br><span class="line">                  rotateLeft(parentOf(x));</span><br><span class="line">                  x = root;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; </span><br><span class="line">          <span class="comment">// x 是其父节点的右孩子，和上面操作相反</span></span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// ...</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将节点 x 置为黑色</span></span><br><span class="line">      setColor(x, BLACK);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这里的调整操作比较复杂，直接以上面的几个删除例子说明，在删除节点 11 和节点 13 的时候比较简单，传入的节点都是节点 15，该节点为红色，所以不用进入 while 循环中，直接将节点置为黑色即可。</p>
<p>现在看一下删除节点 9 前的调整，这里传入的节点是要删除的节点，即节点 9：</p>
<p><img src="https://i.ibb.co/PmkpXqs/delete-node-4.png" alt></p>
<p>调整后从红黑树中删除节点 9 即可。</p>
<p>看完添加和删除元素，增删改查还剩下改和查，分别对应 replace 和 get 方法，这个方法比较简单，下面分别看下：</p>
<h1 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h1><p>replace 有两个重载方法，分别传入两个参数和三个参数，先看下传入两个参数的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">replace</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; p = getEntry(key);</span><br><span class="line">    <span class="keyword">if</span> (p!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        V oldValue = p.value;</span><br><span class="line">        p.value = value;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>该方法传入要更改元素的 key 和新的 value，返回旧的 value，其中在查找节点的时候用到了 getEntry 方法，该方法在分析删除节点的时候看过了，这里不再多说。</p>
<p>另一个带有三个参数的方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replace</span><span class="params">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; p = getEntry(key);</span><br><span class="line">    <span class="keyword">if</span> (p!=<span class="keyword">null</span> &amp;&amp; Objects.equals(oldValue, p.value)) &#123;</span><br><span class="line">        p.value = newValue;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>该方法多了个参数表示旧 value，根据 key 和 value 来更改元素，更改成功就返回 true。</p>
<p>最后看下 get 方法，该方法就更简单了：</p>
<h1 id="get"><a href="#get" class="headerlink" title="get"></a>get</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; p = getEntry(key);</span><br><span class="line">    <span class="keyword">return</span> (p==<span class="keyword">null</span> ? <span class="keyword">null</span> : p.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样是通过 getEntry 方法找到相应节点，返回该节点的 value，没有找到则返回 null。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>下面看一下除了增删改查外的其他方法。</p>
<p>LeetCode 220 题的官方题解上使用到了 TreeSet 的 ceiling 和 floor 方法，而 TreeSet 是基于 TreeMap 实现的，所以这两个方法分别调用了 TreeMap 的 ceilingKey 和 floorKey 方法，所以在这里特别分析一下这两个方法：</p>
<h2 id="ceilingKey"><a href="#ceilingKey" class="headerlink" title="ceilingKey"></a>ceilingKey</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> K <span class="title">ceilingKey</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> keyOrNull(getCeilingEntry(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getCeilingEntry 方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">getCeilingEntry</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">     Entry&lt;K,V&gt; p = root;</span><br><span class="line">     <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">int</span> cmp = compare(key, p.key);</span><br><span class="line">         <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">             <span class="keyword">if</span> (p.left != <span class="keyword">null</span>)</span><br><span class="line">                 p = p.left;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">		<span class="comment">// 找不到相应的 key，返回传入 key 的下一节点</span></span><br><span class="line">                 <span class="keyword">return</span> p;</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">             <span class="keyword">if</span> (p.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                 p = p.right;</span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// 找不到相应的 key 时，寻找传入 key 的下一节点</span></span><br><span class="line">		<span class="comment">// 这里是寻找当前 key 所在左子树的最小父节点，不存在则返回 null</span></span><br><span class="line">                 Entry&lt;K,V&gt; parent = p.parent;</span><br><span class="line">                 Entry&lt;K,V&gt; ch = p;</span><br><span class="line">                 <span class="keyword">while</span> (parent != <span class="keyword">null</span> &amp;&amp; ch == parent.right) &#123;</span><br><span class="line">                     ch = parent;</span><br><span class="line">                     parent = parent.parent;</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">return</span> parent;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125; </span><br><span class="line"><span class="comment">// 找到相等的 key，返回该节点</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">             <span class="keyword">return</span> p;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>该方法根据传入的 key 寻找相应节点，如果没有找到相应节点，就返回比该 key 稍大的下一节点，也没有就返回 null。</p>
<p>所以 ceilingKey 方法就是传入一个 key，如果 TreeMap 存在该 key，则返回该 key，不存在则返回比该 key 稍大的下一个 key。如果传入的 key 是最大的 key，则返回 null。</p>
<p>而 TreeSet 的 ceiling 方法底层就是调用了 TreeMap 的 ceilingKey 方法，只不过把 key 换成了 TreeSet 的元素而已。所以 TreeSet 的 ceiling 方法就是返回传入元素或者是传入元素的下一元素，不存在比传入元素更大的元素则返回 null。</p>
<h2 id="floorKey"><a href="#floorKey" class="headerlink" title="floorKey"></a>floorKey</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> K <span class="title">floorKey</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> keyOrNull(getFloorEntry(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 getFloorEntry 和 getCeilingEntry 方法类似，只是在查找不到相应 key 时，返回比该 key 较小的上一节点，这里就不再分析了。</p>
<p>所以 floorKey 方法就是传入一个 key，如果 TreeMap 存在该 key，则返回该 key，不存在则返回比该 key 稍小的上一个 key。如果传入的 key 是最小的 key，则返回 null。</p>
<p>而 TreeSet 的 floor 方法底层就是调用了 TreeMap 的 floorKey 方法。所以 TreeSet 的 floor 方法就是返回传入元素或者是传入元素的上一元素，不存在比传入元素更小的元素则返回 null。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    
	
	<div>
	  
		<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------　　　　本文到此结束　<i class="fa fa-heart"></i>　感谢您的阅读　　　　-------------</div>
    
</div>

	  
	</div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/源码/" rel="tag"><i class="fa fa-tag"></i> 源码</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/06/RecyclerView-源码分析（二）：布局/" rel="next" title="RecyclerView 源码分析（二）：布局">
                <i class="fa fa-chevron-left"></i> RecyclerView 源码分析（二）：布局
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/30/PriorityQueue-源码分析/" rel="prev" title="PriorityQueue 源码分析">
                PriorityQueue 源码分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://i.ibb.co/ZNQVBbd/head-Image1.jpg" alt="FengZH">
            
              <p class="site-author-name" itemprop="name">FengZH</p>
              <div class="site-description motion-element" itemprop="description">阳光总在风雨后！坚持就是胜利！</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">65</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Mrfzh" title="GitHub &rarr; https://github.com/Mrfzh" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:15521206029@163.com" title="E-Mail &rarr; mailto:15521206029@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#成员变量"><span class="nav-number">2.</span> <span class="nav-text">成员变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Entry"><span class="nav-number">2.1.</span> <span class="nav-text">Entry</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#构造方法"><span class="nav-number">3.</span> <span class="nav-text">构造方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#put"><span class="nav-number">4.</span> <span class="nav-text">put</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#fixAfterInsertion"><span class="nav-number">4.1.</span> <span class="nav-text">fixAfterInsertion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#remove"><span class="nav-number">5.</span> <span class="nav-text">remove</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#getEntry"><span class="nav-number">5.1.</span> <span class="nav-text">getEntry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#deleteEntry"><span class="nav-number">5.2.</span> <span class="nav-text">deleteEntry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fixAfterDeletion"><span class="nav-number">5.3.</span> <span class="nav-text">fixAfterDeletion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#replace"><span class="nav-number">6.</span> <span class="nav-text">replace</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#get"><span class="nav-number">7.</span> <span class="nav-text">get</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#其他"><span class="nav-number">8.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ceilingKey"><span class="nav-number">8.1.</span> <span class="nav-text">ceilingKey</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#floorKey"><span class="nav-number">8.2.</span> <span class="nav-text">floorKey</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FengZH</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
